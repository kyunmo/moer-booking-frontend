# 백엔드 API 요청사항 - 구독 정보 표시 + 환불 미리보기

**요청일**: 2026-02-22
**프론트엔드 구현 상태**: 완료 (백엔드 API 미제공 시 fallback 처리 포함)

---

## 1. GET /api/superadmin/businesses 응답 확장

### 요청 내용
각 매장 객체에 구독 관련 필드 추가 + 필터 파라미터 지원

### 추가 응답 필드 (각 business 객체)
```json
{
  "id": 1,
  "name": "매장명",
  "businessType": "BEAUTY_SHOP",
  "ownerName": "홍길동",
  "status": "ACTIVE",
  "createdAt": "2026-01-15T10:00:00",
  "subscriptionPlan": "BASIC",
  "subscriptionStatus": "ACTIVE",
  "billingCycle": "MONTHLY",
  "nextBillingDate": "2026-03-15",
  "isTrialActive": false
}
```

### 추가 필터 파라미터
| 파라미터 | 타입 | 설명 | 예시 |
|---------|------|------|------|
| `planType` | String | 구독 플랜 필터 | `FREE`, `BASIC` |
| `subscriptionStatus` | String | 구독 상태 필터 | `ACTIVE`, `TRIAL`, `EXPIRED`, `CANCELED` |

### 우선순위: P1

---

## 2. GET /api/superadmin/businesses/{id} 응답 확장

### 요청 내용
매장 상세 조회 시 구독 상세 정보 + 최근 결제 내역 포함

### 응답 구조
```json
{
  "id": 1,
  "name": "매장명",
  "businessType": "BEAUTY_SHOP",
  "ownerName": "홍길동",
  "ownerEmail": "owner@example.com",
  "address": "서울시 강남구...",
  "status": "ACTIVE",
  "createdAt": "2026-01-15T10:00:00",
  "subscription": {
    "plan": "BASIC",
    "status": "ACTIVE",
    "billingCycle": "MONTHLY",
    "startDate": "2026-01-15",
    "nextBillingDate": "2026-03-15",
    "trialEndDate": null,
    "isTrialActive": false,
    "currentStaffCount": 3,
    "maxStaff": 5,
    "currentMonthReservationCount": 45,
    "maxMonthlyReservations": -1
  },
  "recentPayments": [
    {
      "id": 101,
      "amount": 19800,
      "status": "COMPLETED",
      "createdAt": "2026-02-15T09:00:00",
      "subscriptionPlan": "BASIC",
      "paymentMethod": "CARD"
    }
  ]
}
```

### 우선순위: P1

---

## 3. GET /api/payments/{paymentId}/refund-preview (신규)

### 요청 내용
환불 전 예상 금액 미리보기 API

### 응답 구조
```json
{
  "paymentId": 101,
  "originalAmount": 19800,
  "refundAmount": 13200,
  "usedDays": 10,
  "remainingDays": 20,
  "totalDays": 30,
  "usagePercent": 33,
  "isFullRefund": false,
  "formula": "19,800원 x (20일 / 30일)"
}
```

### 계산 로직
```
환불금액 = finalAmount × (잔여일수 / 총일수)
- 결제 당일 → 전액 환불
- 7일 이내 → 전액 환불 (정책)
- 기간 만료 → 0원
- 그 외 → 일할 계산
```

### 프론트엔드 fallback
API 미제공 시 `src/utils/refundCalculator.js`에서 동일 로직으로 프론트 계산 수행.
API 제공 후에도 서버 계산 우선, 실패 시 프론트 fallback 유지.

### 우선순위: P2

---

## 참고: 프론트엔드 구현 파일 목록

| 파일 | 설명 |
|------|------|
| `src/utils/refundCalculator.js` | 환불 계산 유틸리티 (프론트 fallback) |
| `src/api/payment.js` | `getRefundPreview` 메서드 추가 |
| `src/stores/payment.js` | `refundPreview` state/action 추가 |
| `src/stores/superadmin.js` | `selectedBusiness`, `fetchBusinessDetail` 추가 |
| `src/components/super/BusinessDetailDialog.vue` | 매장 상세 다이얼로그 (4탭) |
| `src/pages/shop-admin/super/businesses/index.vue` | 테이블 컬럼+필터+상세보기 연동 |
| `src/pages/shop-admin/payment/history.vue` | 환불 다이얼로그 개선 |
| `src/pages/shop-admin/subscription/index.vue` | 구독 취소 시 환불 미리보기 |
| `src/components/subscription/PlanChangeDialog.vue` | 다운그레이드 환불 안내 |
