# 백엔드 요청사항 - Booking 서비스 개선 (2026-02-21)

> 프론트엔드 작업 과정에서 확인된 백엔드 신규 구현/수정 필요 사항 정리

---

## 1. [필수] 고객 예약 목록 조회 API

### 엔드포인트
```
GET /api/customer/reservations
Authorization: Bearer {customerAccessToken}
```

### 설명
- 로그인한 고객(Customer)의 예약 목록을 조회하는 API
- **현재 상태**: 프론트엔드에서 호출하고 있으나, 응답이 비어있거나 엔드포인트가 구현되지 않은 것으로 보임
- **"내 예약" 페이지**에서 사용

### Query Parameters

| 파라미터 | 타입 | 필수 | 설명 |
|---------|------|------|------|
| page | Number | N | 페이지 번호 (1-based 또는 0-based, 프론트에서 1부터 전송) |
| size | Number | N | 페이지 크기 (기본 10) |
| status | String | N | 상태 필터: `PENDING`, `CONFIRMED`, `COMPLETED`, `CANCELLED` (없으면 전체) |

### 응답 형식 (Spring Data Page 권장)

```json
{
  "success": true,
  "data": {
    "content": [
      {
        "reservationNumber": "260221-A3B9",
        "businessName": "모어 헤어살롱",
        "businessSlug": "moer-hair",
        "businessProfileImageUrl": "https://...",
        "reservationDate": "2026-03-01",
        "startTime": "14:00",
        "endTime": "15:00",
        "staffName": "김직원",
        "staffId": 1,
        "services": ["커트", "염색"],
        "totalPrice": 50000,
        "status": "CONFIRMED",
        "canCancel": true,
        "hasReview": false,
        "createdAt": "2026-02-21T10:00:00"
      }
    ],
    "totalElements": 5,
    "totalPages": 1,
    "page": 1,
    "size": 10
  }
}
```

### 필수 응답 필드

| 필드 | 타입 | 설명 |
|------|------|------|
| reservationNumber | String | 예약번호 |
| businessName | String | 매장명 |
| businessSlug | String | 매장 슬러그 (매장 링크용) |
| businessProfileImageUrl | String? | 매장 프로필 이미지 URL |
| reservationDate | String | 예약일 (YYYY-MM-DD) |
| startTime | String | 시작 시간 (HH:mm) |
| endTime | String | 종료 시간 (HH:mm) |
| staffName | String? | 담당자명 (null이면 자동배정) |
| staffId | Number? | 담당자 ID (재예약용) |
| services | Array | 서비스명 배열 (문자열 또는 `{id, name}` 객체) |
| totalPrice | Number | 총 금액 (원) |
| status | String | 상태: PENDING/CONFIRMED/COMPLETED/CANCELLED |
| canCancel | Boolean | 취소 가능 여부 |
| hasReview | Boolean | 리뷰 작성 여부 |
| createdAt | String | 예약 생성일시 (ISO 8601) |

### 인증
- `Authorization: Bearer {customerAccessToken}` 헤더에서 고객 식별
- 해당 고객의 예약만 반환
- 401: 토큰 없음/만료 → 에러코드 A003
- 403: 고객 권한 아님 → 에러코드 CP002

---

## 2. [필수] 매장 상세 조회 - slug 또는 ID 지원

### 엔드포인트
```
GET /api/public/businesses/{slugOrId}
```

### 설명
- 현재 slug 기반으로만 매장 상세 조회 가능
- **slug가 설정되지 않은 매장**은 검색 결과에서 클릭 시 404 발생
- slug가 없는 경우 `business.id`(숫자)로 조회할 수 있어야 함

### 요청사항
- `{slugOrId}` 파라미터가 숫자인 경우 → ID로 조회
- `{slugOrId}` 파라미터가 문자열인 경우 → slug로 조회
- 기존 slug 조회 로직에 ID 조회 fallback 추가

### 프론트엔드 대응
- 프론트에서 `business.slug || business.id`로 전송하도록 이미 수정 완료

---

## 3. [확인] 고객 예약 생성 후 고객 연결

### 엔드포인트
```
POST /api/customer/businesses/{slug}/reservations
Authorization: Bearer {customerAccessToken}
```

### 확인사항
- 이 API로 생성된 예약이 고객 계정에 정상적으로 연결되는지 확인
- `GET /api/customer/reservations`에서 해당 예약이 조회되어야 함
- 고객 토큰에서 추출된 고객 ID가 예약 레코드의 `customerId` 필드에 저장되어야 함

---

## 4. [확인] 기존 고객 API 엔드포인트 동작 확인

아래 엔드포인트들이 정상 동작하는지 확인 필요:

| 엔드포인트 | 메서드 | 설명 | 상태 |
|-----------|--------|------|------|
| `/api/customer/reservations` | GET | 내 예약 목록 | **확인 필요** |
| `/api/customer/reservations/{reservationNumber}` | GET | 예약 상세 | 확인 필요 |
| `/api/customer/reservations/{reservationNumber}/cancel` | POST | 예약 취소 | 확인 필요 |
| `/api/customer/profile` | GET | 프로필 조회 | 동작 확인됨 |
| `/api/customer/profile` | PATCH | 프로필 수정 | 동작 확인됨 |
| `/api/customer/businesses/{slug}/reservations` | POST | 예약 생성 | 동작 확인됨 |
| `/api/customer/businesses/{slug}/reviews` | POST | 리뷰 작성 | 확인 필요 |

---

## 5. [참고] 프론트엔드 완료 작업 내역

### 5-1. 매장 검색 페이지
- [x] 태블릿 햄버거 메뉴 동작 수정 (Teleport 적용)
- [x] 정렬 버튼 UI 깨짐 수정
- [x] slug 없는 매장 → ID fallback 처리
- [x] 로그인 상태에서 "예약확인" → "내 예약" 전환

### 5-2. 매장 상세 페이지 - 리뷰 작성
- [x] 로그인 시 예약 선택 드롭다운 (예약번호 직접 입력 대신)
- [x] COMPLETED + 미리뷰 예약만 필터링하여 표시
- [x] 비로그인 시 기존 수동 입력 유지

### 5-3. 내 예약 페이지
- [x] API 응답 형식 다중 대응 (Spring Page / custom / array)
- [x] 서비스 표시 문자열/객체 양쪽 대응
- [x] 디버그 로그 추가 (`console.log('[내 예약] API 응답:...')`)
- [ ] **백엔드 `GET /api/customer/reservations` 구현 확인 필요**

---

## 6. 우선순위

| 순위 | 항목 | 이유 |
|------|------|------|
| P0 | 고객 예약 목록 API 구현 | 내 예약 페이지 핵심 기능 |
| P0 | 매장 상세 slug/ID 지원 | slug 미설정 매장 접근 불가 |
| P1 | 예약 생성 시 고객 연결 확인 | 목록 조회의 전제 조건 |
| P2 | 나머지 고객 API 동작 확인 | 상세조회/취소/리뷰 |
