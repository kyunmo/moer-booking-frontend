# 백엔드 요청사항 (2026-02-22)

프론트엔드 업데이트에 따른 백엔드 작업 요청사항을 정리합니다.

---

## 1. 유료 요금제 가격 변경

### 변경 내용
| 항목 | 기존 | 변경 |
|------|------|------|
| 월간 공급가액 | 20,000원 | **18,000원** |
| 월간 VAT 포함 | 22,000원 | **19,800원** |
| 연간 공급가액 | 200,000원 | **180,000원** |
| 연간 VAT 포함 | 220,000원 | **198,000원** |

### 요청 작업
- [ ] 결제 금액 검증 로직에서 BASIC(=PAID) 플랜 가격을 18,000원(공급가액)/19,800원(VAT포함)으로 변경
- [ ] 구독 정보 조회 API(`GET /api/subscription`)에서 `monthlyPrice`, `yearlyPrice` 필드 업데이트
- [ ] 결제 생성 API(`POST /api/payments`)에서 금액 검증 로직 업데이트
- [ ] PG사(결제대행사) 연동 시 상품 금액 변경
- [ ] 기존 구독자의 다음 결제부터 새 가격 적용 (또는 기존 가격 유지 정책 결정 필요)

### 참고
- 프론트엔드 planAdapter: `PAID` ↔ `BASIC` 변환은 동일
- 연간 결제 = 월 10개월분 (2개월 무료 혜택 유지)

---

## 2. 문의하기 API 신규 개발

### 엔드포인트
```
POST /api/public/inquiries
```

### 요청 Body
```json
{
  "name": "홍길동",
  "email": "example@email.com",
  "phone": "010-1234-5678",   // nullable
  "type": "GENERAL",           // GENERAL | FEATURE_REQUEST | BUG_REPORT | PARTNERSHIP
  "content": "문의 내용..."
}
```

### 요청 작업
- [ ] `POST /api/public/inquiries` 엔드포인트 생성 (인증 불필요 - public API)
- [ ] 문의 데이터 DB 저장 (inquiries 테이블)
- [ ] 문의 접수 시 관리자 이메일 알림 발송 (kkm@moer.io)
- [ ] 문의 접수 확인 이메일 자동 발송 (문의자 이메일로)
- [ ] 스팸 방지 대책 (rate limiting: IP당 5건/시간 등)

### 응답
```json
// 성공 (201 Created)
{
  "id": 1,
  "message": "문의가 접수되었습니다."
}

// 실패 (429 Too Many Requests)
{
  "code": "IQ001",
  "message": "너무 많은 문의를 보내셨습니다. 잠시 후 다시 시도해주세요."
}
```

### DB 스키마 제안
```sql
CREATE TABLE inquiries (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(50) NOT NULL,
  email VARCHAR(100) NOT NULL,
  phone VARCHAR(20),
  type VARCHAR(30) NOT NULL,  -- GENERAL, FEATURE_REQUEST, BUG_REPORT, PARTNERSHIP
  content TEXT NOT NULL,
  status VARCHAR(20) DEFAULT 'PENDING',  -- PENDING, IN_PROGRESS, RESOLVED, CLOSED
  admin_note TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

---

## 3. 매출/통계 페이지 접근 제어

### 현재 문제
- 30일 무료 체험(TRIAL) 기간 중 통계 API 호출 시 TR002 에러("체험판에서는 사용할 수 없는 기능입니다") 반환됨
- 프론트엔드에서 체험 기간 중에는 모든 기능 사용 가능하도록 변경함

### 요청 작업
- [ ] 통계 API(`GET /api/businesses/{id}/statistics/*`)에서 TRIAL 상태일 때 접근 허용
- [ ] 에러 메시지 변경: "체험판에서는 사용할 수 없는 기능입니다" → "무료 버전에서는 사용할 수 없는 기능입니다"
- [ ] 접근 제어 규칙 정리:

| 구독 상태 | 통계 API 접근 |
|-----------|-------------|
| TRIAL (active) | **허용** |
| PAID (ACTIVE) | **허용** |
| FREE (EXPIRED) | **차단** (에러코드 반환) |

### 에러 응답 형식
```json
{
  "code": "TR002",
  "message": "무료 버전에서는 사용할 수 없는 기능입니다. 유료 플랜으로 업그레이드해주세요."
}
```

---

## 4. 가격 변경에 따른 기타 확인 사항

### 확인 필요
- [ ] 기존 유료 구독자의 가격 정책 (기존 22,000원 → 19,800원으로 변경 적용 시점)
- [ ] 쿠폰 할인율/금액 조정 필요 여부
- [ ] 환불 정책의 일할 계산 로직 가격 반영
- [ ] 세금계산서 발행 금액 업데이트

---

## 변경된 프론트엔드 파일 목록

### 가격 변경 (Task 1)
- `src/constants/pricing.js` - PLANS.PAID 가격 변경
- `src/components/public/landing/PricingPreviewSection.vue` - 랜딩 가격 표시
- `src/pages/pricing.vue` - 요금제 페이지 전체
- `src/pages/faq.vue` - FAQ 가격 텍스트
- `src/pages/shop-admin/subscription/index.vue` - 구독 관리 가격
- `src/pages/shop-admin/payment/index.vue` - 결제 페이지 가격
- `src/components/subscription/PlanChangeDialog.vue` - 플랜 변경 다이얼로그

### 관리자 레이아웃 (Task 2)
- `src/layouts/components/DefaultLayoutWithVerticalNav.vue` - 상단바 순서/UI 개선

### 문의하기 모달 (Task 3)
- `src/api/inquiry.js` - **신규** 문의 API
- `src/components/common/InquiryFormDialog.vue` - **신규** 문의 모달 컴포넌트
- `src/layouts/components/Footer.vue` - 관리자 푸터
- `src/components/public/PublicFooter.vue` - 공용 푸터
- `src/pages/support.vue` - 고객지원 페이지
- `src/pages/faq.vue` - FAQ 페이지
- `src/pages/pricing.vue` - 요금제 페이지

### 통계 접근 제어 (Task 4)
- `src/pages/shop-admin/statistics/index.vue` - 접근 제어 + blur 오버레이

### 날짜 선택 개선 (Task 5)
- `src/assets/styles/styles.scss` - 글로벌 CSS (전체 date/time 필드)
- `src/pages/shop-admin/statistics/components/StatisticsFilterBar.vue` - 아이콘 추가
- `src/components/coupon/CouponFormDialog.vue` - 아이콘 추가
- `src/pages/shop-admin/super/audit-logs/index.vue` - 아이콘 추가
- `src/pages/shop-admin/reviews/list.vue` - 아이콘 추가
- `src/pages/shop-admin/reservations/list.vue` - 아이콘 추가
- `src/pages/shop-admin/staffs/components/StaffScheduleTab.vue` - 아이콘 추가
- `src/pages/shop-admin/staffs/components/StaffDialog.vue` - 아이콘 추가
