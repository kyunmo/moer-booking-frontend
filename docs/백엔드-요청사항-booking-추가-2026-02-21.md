# 백엔드 추가 요청사항 - Customer Reservation 응답 필드 (2026-02-21)

> **배경:** `백엔드-작업완료-booking-2026-02-21.md` 검토 후 발견된 프론트엔드 연동 이슈

---

## 1. [필수] 고객 예약 목록/상세 응답에 `businessId` 필드 추가

### 문제

현재 `GET /api/customer/reservations` 응답에 `businessSlug` 필드는 있으나 `businessId`가 없음.

`businessSlug`는 nullable(매장에 slug 미설정 시 null)이므로, slug가 없는 매장의 예약일 경우 프론트엔드에서 **매장 페이지 이동, 리뷰 작성, 재예약** 기능이 모두 동작하지 않음.

### 영향받는 기능

| 기능 | 사용 위치 | 현재 문제 |
|------|----------|----------|
| 매장 페이지 이동 | 내 예약 > 매장명 클릭 | businessSlug null이면 이동 불가 |
| 리뷰 작성 | 내 예약 > 리뷰 작성 버튼 | `/booking/{slug}/review` 경로 생성 불가 |
| 재예약 | 내 예약 > 재예약 버튼 | `/booking/{slug}/reserve` 경로 생성 불가 |
| 매장 상세 링크 | 예약 상세 다이얼로그 | 매장명 링크 생성 불가 |

### 요청사항

**아래 2개 API 응답에 `businessId` 필드 추가:**

#### 1) 내 예약 목록
```
GET /api/customer/reservations
```

#### 2) 예약 상세
```
GET /api/customer/reservations/{reservationNumber}
```

### 추가할 필드

```json
{
  "reservationNumber": "260221-A3B9",
  "businessId": 1,              // ← 추가 요청
  "businessName": "모어 헤어살롱",
  "businessSlug": null,          // slug가 null인 경우
  "businessProfileImageUrl": null,
  ...
}
```

| 필드 | 타입 | 설명 |
|------|------|------|
| businessId | Number | 매장 ID (NOT NULL, FK) |

### 프론트엔드 대응 (이미 완료)

```javascript
// my-reservations.vue - 이미 반영 완료
function getBusinessIdentifier(reservation) {
  return reservation.businessSlug || reservation.businessId || null
}

// businessSlug가 null이면 businessId로 fallback
router.push(`/booking/${identifier}/reserve`)
```

### 예상 변경 범위

| 파일 | 변경 |
|------|------|
| `CustomerBookingService.java` | `getMyReservations()` / `getReservationDetail()` 응답 DTO에 `businessId` 추가 |
| 관련 Response DTO | `businessId` 필드 추가 |

### 우선순위: **P0 (필수)**

> `GET /api/public/businesses/{slugOrId}` API가 이미 ID 조회를 지원하므로,
> `businessId`만 추가되면 slug 없는 매장도 완벽히 동작합니다.

---

## 참고: 프론트엔드 완료 작업

### 백엔드 작업완료 문서 기반 연동 확인 결과

| 항목 | 프론트 상태 | 비고 |
|------|-----------|------|
| 고객 예약 목록 API 연동 | ✅ 완료 | 페이징 + 상태 필터 + 다형 파싱 |
| 매장 slug/ID 양쪽 지원 | ✅ 완료 | `business.slug \|\| business.id` |
| NO_SHOW 상태 추가 | ✅ 완료 | statusConfig + statusFilters |
| 서비스 객체/문자열 대응 | ✅ 완료 | `typeof service === 'string' ? service : service.name` |
| 예약 취소 (reason 전송) | ✅ 완료 | JWT 기반 본인 확인 |
| 리뷰 작성 (예약 선택) | ✅ 완료 | COMPLETED + 미리뷰 필터링 |
| 네이버/구글 고객 OAuth | ✅ 완료 | 로그인 페이지 3개 버튼 |
| 이름+전화번호 예약 조회 | ✅ 완료 | reservation.vue에서 사용 |
| 매장 휴무일 API | ✅ API 레이어 완료 | public-booking.js에 추가됨 |
| addressDetail/zipCode | ✅ 완료 | 매장설정 + 매장상세 + KakaoMap |
| businessSlug null 대응 | ✅ 완료 | businessId fallback (위 요청 필요) |
| debug console.log 제거 | ✅ 완료 | my-reservations.vue |
