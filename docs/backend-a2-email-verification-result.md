# A-2. 이메일 발송 연동 검증 - 백엔드 확인 결과

> **작성일:** 2026-02-18
> **상태:** 백엔드 구현 완료 + 보안 개선 완료

---

## 1. API 현황

### POST /api/auth/forgot-password

**요청:**
```json
{
  "email": "user@example.com"
}
```

**응답 (항상 성공):**
```json
{
  "success": true,
  "message": "비밀번호 재설정 이메일을 발송했습니다. 이메일을 확인해주세요.",
  "data": null
}
```

> **보안 개선 (2026-02-18):** 미등록 이메일로 요청해도 동일한 성공 응답을 반환합니다.
> 이전에는 미등록 이메일 시 `U001 USER_NOT_FOUND` 에러가 발생하여 사용자 존재 여부가 노출되었습니다.
> **수정 파일:** `AuthService.java` - `requestPasswordReset()` 메서드

---

### POST /api/auth/reset-password

**요청:**
```json
{
  "token": "uuid-token-from-email",
  "newPassword": "NewPass123!"
}
```

**성공 응답:**
```json
{
  "success": true,
  "message": "비밀번호가 재설정되었습니다. 새 비밀번호로 로그인해주세요.",
  "data": null
}
```

**에러 응답:**

| 에러 코드 | HTTP 상태 | 메시지 | 설명 |
|----------|----------|--------|------|
| `PR001` | 400 | 유효하지 않은 재설정 토큰입니다 | 잘못된/존재하지 않는 토큰 |
| `PR002` | 400 | 만료된 재설정 토큰입니다 | 30분 초과 |
| `PR003` | 400 | 이미 사용된 재설정 토큰입니다 | 이미 사용된 토큰 |

---

## 2. 이메일 발송 스펙

| 항목 | 값 |
|------|-----|
| SMTP 서버 | smtp.worksmobile.com (네이버 웍스) |
| 발송 이메일 | kkm@moer.io |
| 이메일 제목 | [moer] 비밀번호 재설정 안내 |
| 이메일 형식 | HTML (Thymeleaf 템플릿) |
| 처리 방식 | 비동기 (@Async) |
| 토큰 유효 시간 | 30분 |

### 리셋 URL 형식
```
{FRONTEND_URL}/reset-password?token={uuid-token}
```
- 현재 FRONTEND_URL: `http://localhost:3000`
- 프로덕션 시 환경변수 `FRONTEND_URL`로 변경

### HTML 템플릿 내용
- 사용자 이름 표시
- "비밀번호 재설정하기" 버튼 (링크)
- 30분 유효 경고
- "요청하지 않으셨다면 무시" 안내

---

## 3. 프론트엔드 검증 체크리스트

### 정상 플로우
- [ ] forgot-password 페이지에서 이메일 입력 → 발송 요청
- [ ] 이메일 수신 확인 (kkm@moer.io에서 발송)
- [ ] 이메일 내 링크 클릭 → reset-password 페이지로 이동
- [ ] 새 비밀번호 입력 → 재설정 완료
- [ ] 새 비밀번호로 로그인 성공

### 에러 케이스
- [ ] 미등록 이메일 → "발송완료" 응답 (에러 아님, 보안상 동일 응답)
- [ ] 만료된 토큰 (30분 후) → `PR002` 에러
- [ ] 이미 사용된 토큰 → `PR003` 에러
- [ ] 잘못된 토큰 → `PR001` 에러

### 프론트엔드 디버그 코드 제거
- [ ] `forgot-password.vue:51` - console.log 제거
- [ ] `reset-password.vue:65` - console.log 제거

---

## 4. 참고: 비밀번호 재설정 후 동작

- 기존 모든 Refresh Token이 삭제됩니다 (다른 기기에서도 로그아웃 강제)
- 새 비밀번호로 다시 로그인해야 합니다
- 비밀번호 정책: 8자 이상

---

## 5. 변경 이력

| 날짜 | 변경 내용 |
|------|----------|
| 2026-02-18 | 미등록 이메일 시 보안 처리 개선 (동일 응답 반환) |
